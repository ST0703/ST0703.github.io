<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Virtual Pet â€” Web</title>
  <style>
    body{font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans TC', sans-serif; background:#f7f7fb; color:#222; display:flex; align-items:center; justify-content:center; min-height:100vh;}
    .card{width:360px; background:#fff; padding:18px; border-radius:12px; box-shadow:0 6px 20px rgba(20,20,50,0.08)}
    pre.ascii{background:#f0f4ff; padding:8px; border-radius:8px; font-size:13px;}
    .row{display:flex; gap:8px; flex-wrap:wrap}
    button{flex:1;padding:8px;border-radius:8px;border:0;background:#5564f2;color:#fff;font-weight:600}
    .muted{color:#666;font-size:13px}
    .stat{display:flex;justify-content:space-between; margin:6px 0}
    .small{font-size:12px}
    select,input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid #e3e7f7}
  </style>
</head>
<body>
  <div class="card" id="app">
    <div id="setup">
      <h2>å»ºç«‹ä½ çš„é›»å­å¯µç‰©</h2>
      <label class="small">åå­—</label>
      <input id="name" type="text" value="Pico" />
      <label class="small">ç¨®é¡</label>
      <select id="species">
        <option value="è²“">ğŸ± è²“</option>
        <option value="ç‹—">ğŸ¶ ç‹—</option>
        <option value="å°é¾">ğŸ‰ å°é¾</option>
      </select>
      <div style="height:10px"></div>
      <div class="row">
        <button id="newBtn">å»ºç«‹æ–°å¯µç‰©</button>
        <button id="loadBtn" style="background:#22c55e">è®€å–å­˜æª”</button>
      </div>
    </div>

    <div id="game" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div id="petName" style="font-weight:700;font-size:18px"></div>
          <div id="petInfo" class="muted small"></div>
        </div>
        <div><button id="saveBtn" style="background:#f59e0b">å­˜æª”</button></div>
      </div>

      <pre id="art" class="ascii">ASCII</pre>

      <div id="stats">
        <!-- ç‹€æ…‹åˆ— -->
      </div>

      <div class="row">
        <button id="feed">é¤µé£Ÿ</button>
        <button id="play">ç©è€</button>
        <button id="sleep">ç¡è¦º</button>
      </div>

      <div style="height:8px"></div>
      <div class="row">
        <button id="statusBtn" style="background:#64748b">æŸ¥çœ‹ç‹€æ…‹</button>
        <button id="quit" style="background:#ef4444">é›¢é–‹</button>
      </div>

      <div style="height:10px"></div>
      <div id="log" class="muted small"></div>
    </div>

  </div>

<script>
// ======= è³‡æ–™æ¨¡å‹ & ASCII è¡¨æƒ… =======
const ART = {
  'è²“': {happy: ` /\_/\n( ^_^ )\n > ^ <`, normal:` /\_/\n( o_o )\n > ^ <`, sad:` /\_/\n( -_- )\n > ^ <`},
  'ç‹—': {happy:` /\___/\\n( ^_^  )\n / >ğŸ– >`, normal:` /\___/\\n( o_o  )\n /  >  >`, sad:` /\___/\\n( T_T  )\n /  >  >`},
  'å°é¾': {happy:`  /\____/\  \n ( ^w^  ) \n  /  ğŸ”¥ \\`, normal:`  /\____/\  \n ( o_o  ) \n  /  ğŸ”¥ \\`, sad:`  /\____/\  \n ( ;_;  ) \n  /  ğŸ”¥ \\`}
}

const SAVE_KEY = 'virtual_pet_save_v1'

function makePet(name, species){
  return {
    name, species,
    hunger:40, mood:60, energy:70, health:100,
    age:0, level:1, exp:0,
    lastTick: Date.now()
  }
}

// ======= éŠæˆ²é‚è¼¯ =======
let pet = null
let tickInterval = null

function startTimer(){
  if(tickInterval) clearInterval(tickInterval)
  tickInterval = setInterval(()=>{
    if(!pet) return
    const now = Date.now()
    if(now - pet.lastTick >= 10000){
      pet.lastTick = now
      pet.hunger = Math.min(pet.hunger + 5,100)
      pet.energy = Math.max(pet.energy - 5,0)
      pet.mood = Math.max(pet.mood - 3,0)
      if(Math.random() < 0.05){ pet.health = Math.max(pet.health - 10,0); appendLog('âš ï¸ å¯µç‰©ç”Ÿç—…äº†ï¼') }
      pet.age += 1
      addExp(3)
      render()
    }
  },1000)
}

function addExp(amount){ pet.exp += amount; if(pet.exp >= 100){ pet.exp -= 100; pet.level += 1; appendLog(`ğŸ‰ ${pet.name} å‡ç´šåˆ° Lv.${pet.level}ï¼`) } }

function feed(){ appendLog(`ğŸ ä½ é¤µé£Ÿ ${pet.name}`); pet.hunger = Math.max(pet.hunger - 25,0); pet.mood = Math.min(pet.mood + 5,100); addExp(10); render() }
function play(){ appendLog(`ğŸ® ä½ å’Œ ${pet.name} ç©è€`); if(pet.species==='è²“'){ pet.mood = Math.min(pet.mood+25,100); pet.energy = Math.max(pet.energy-8,0); pet.hunger = Math.min(pet.hunger+8,100); addExp(15) }
  else if(pet.species==='ç‹—'){ pet.mood = Math.min(pet.mood+20,100); pet.energy = Math.max(pet.energy-20,0); pet.hunger = Math.min(pet.hunger+12,100); addExp(20)}
  else { pet.mood = Math.min(pet.mood+15,100); pet.energy = Math.max(pet.energy-15,0); pet.hunger = Math.min(pet.hunger+10,100); addExp(15)}
  render()
}
function sleepPet(){ appendLog(`ğŸ˜´ ${pet.name} ç¡è¦º`); if(pet.species==='å°é¾'){ pet.energy = Math.min(pet.energy+50,100); pet.hunger = Math.min(pet.hunger+15,100); addExp(10) } else { pet.energy = Math.min(pet.energy+30,100); pet.hunger = Math.min(pet.hunger+10,100); addExp(5) } render() }

function appendLog(s){ const el = document.getElementById('log'); el.textContent = s }

function renderStats(){
  const s = document.getElementById('stats'); s.innerHTML = '';
  const addLine = (k,v)=>{ const div = document.createElement('div'); div.className='stat'; div.innerHTML = `<div class='muted'>${k}</div><div>${v}</div>`; s.appendChild(div) }
  addLine('ç­‰ç´š', `Lv.${pet.level} (${pet.exp}/100)`)
  addLine('å¹´é½¡', `${pet.age} å¤©`)
  addLine('é£¢é¤“', `${pet.hunger}/100`)
  addLine('å¿ƒæƒ…', `${pet.mood}/100`)
  addLine('èƒ½é‡', `${pet.energy}/100`)
  addLine('å¥åº·', `${pet.health}/100`)
}

function render(){
  if(!pet) return
  document.getElementById('petName').textContent = pet.name
  document.getElementById('petInfo').textContent = `${pet.species} â€¢ Lv.${pet.level}`
  const art = getArt()
  document.getElementById('art').textContent = art
  renderStats()
}

function getArt(){
  if(pet.health < 40 || pet.mood < 40) return ART[pet.species].sad
  if(pet.mood > 70) return ART[pet.species].happy
  return ART[pet.species].normal
}

function save(){ localStorage.setItem(SAVE_KEY, JSON.stringify(pet)); appendLog('ğŸ’¾ å·²å­˜æª”') }
function load(){ const raw = localStorage.getItem(SAVE_KEY); if(!raw) return null; try{ return JSON.parse(raw) }catch(e){return null} }

// ===== UI ç¶å®š =====
document.getElementById('newBtn').addEventListener('click', ()=>{
  const name = document.getElementById('name').value || 'Pico'
  const species = document.getElementById('species').value
  pet = makePet(name, species)
  document.getElementById('setup').style.display='none'
  document.getElementById('game').style.display='block'
  appendLog('ğŸ†• å»ºç«‹æ–°å¯µç‰©')
  startTimer(); render()
})

document.getElementById('loadBtn').addEventListener('click', ()=>{
  const data = load()
  if(!data){ alert('æ²’æœ‰å­˜æª”'); return }
  pet = data
  document.getElementById('setup').style.display='none'
  document.getElementById('game').style.display='block'
  appendLog('ğŸ“‚ è®€å–å­˜æª”')
  startTimer(); render()
})

document.getElementById('feed').addEventListener('click', ()=>{ feed() })
document.getElementById('play').addEventListener('click', ()=>{ play() })
document.getElementById('sleep').addEventListener('click', ()=>{ sleepPet() })
document.getElementById('statusBtn').addEventListener('click', ()=>{ render(); appendLog('ğŸ” æŸ¥çœ‹ç‹€æ…‹') })
document.getElementById('quit').addEventListener('click', ()=>{ if(tickInterval) clearInterval(tickInterval); pet=null; document.getElementById('setup').style.display='block'; document.getElementById('game').style.display='none'; appendLog('ğŸ‘‹ é›¢é–‹éŠæˆ²') })
document.getElementById('saveBtn').addEventListener('click', ()=>{ save() })

// auto-load prompt
if(localStorage.getItem(SAVE_KEY)){
  // ä¸è‡ªå‹•è®€ï¼Œä½†å‘ŠçŸ¥å¯è®€æª”
  console.log('å­˜æª”å¯ä½¿ç”¨ã€Œè®€å–å­˜æª”ã€æŒ‰éˆ•è¼‰å…¥')
}

</script>
</body>
</html>

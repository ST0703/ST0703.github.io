import tkinter as tk
from datetime import date
import random
import json
import os

# ===== åˆé¤è³‡æ–™ =====
LUNCH_OPTIONS = {
    "ä¾¿ç•¶": ["é›è…¿ä¾¿ç•¶", "æ’éª¨ä¾¿ç•¶", "æ»·è‚‰ä¾¿ç•¶", "è”¬èœä¾¿ç•¶"],
    "éºµ": ["ç‰›è‚‰éºµ", "ä¹¾æ‹Œéºµ", "æ‹‰éºµ", "ç‚’éºµ"],
    "é£¯": ["å’–å“©é£¯", "ç‚’é£¯", "ä¸¼é£¯", "æ»·è‚‰é£¯"],
    "é€Ÿé£Ÿ": ["æ¼¢å ¡", "ç‚¸é›", "æŠ«è–©", "è–¯æ¢"]
}

DATA_FILE = "lunch_record.json"


# ===== æ¯å¤©ä¸é‡è¤‡ç´€éŒ„ =====
def load_record():
    if not os.path.exists(DATA_FILE):
        return {"date": str(date.today()), "used": []}

    with open(DATA_FILE, "r", encoding="utf-8") as f:
        record = json.load(f)

    if record["date"] != str(date.today()):
        record = {"date": str(date.today()), "used": []}

    return record


def save_record(record):
    with open(DATA_FILE, "w", encoding="utf-8") as f:
        json.dump(record, f, ensure_ascii=False, indent=2)


record = load_record()


# ===== UI =====
root = tk.Tk()
root.title("åˆé¤å»ºè­°æ©Ÿå™¨äºº")
root.geometry("420x550")
root.configure(bg="#f0f0f0")

chat_frame = tk.Frame(root, bg="#f0f0f0")
chat_frame.pack(fill="both", expand=True, padx=10, pady=10)


def add_bubble(text, side="left"):
    bubble = tk.Label(
        chat_frame,
        text=text,
        wraplength=260,
        justify="left",
        font=("Arial", 11),
        padx=10,
        pady=6
    )

    if side == "left":
        bubble.configure(bg="#ffffff")
        bubble.pack(anchor="w", pady=4)
    else:
        bubble.configure(bg="#dcf8c6")
        bubble.pack(anchor="e", pady=4)

    chat_frame.update_idletasks()
    chat_frame.yview_moveto(1)


def get_lunch_suggestion(category):
    if category == "éš¨æ©Ÿ":
        options = []
        for foods in LUNCH_OPTIONS.values():
            options.extend(foods)
    else:
        options = LUNCH_OPTIONS.get(category, [])

    available = [f for f in options if f not in record["used"]]

    if not available:
        return "ğŸ¤– ä»Šå¤©çš„é¤é»éƒ½è¢«æˆ‘æ¨è–¦éå›‰ï¼"

    choice = random.choice(available)
    record["used"].append(choice)
    save_record(record)

    return f"ğŸ¤– ä»Šå¤©åˆé¤å»ºè­°ä½ åƒï¼š{choice}"


def choose(category):
    add_bubble(category, "right")
    reply = get_lunch_suggestion(category)
    root.after(300, lambda: add_bubble(reply, "left"))


# ===== æŒ‰éˆ•å€ =====
btn_frame = tk.Frame(root, bg="#f0f0f0")
btn_frame.pack(pady=5)

buttons = ["ä¾¿ç•¶", "éºµ", "é£¯", "é€Ÿé£Ÿ", "éš¨æ©Ÿ"]

for text in buttons:
    btn = tk.Button(
        btn_frame,
        text=text,
        width=8,
        font=("Arial", 11),
        command=lambda t=text: choose(t)
    )
    btn.pack(side="left", padx=4, pady=4)


add_bubble("ğŸ¤– ä½ å¥½ï¼ç›´æ¥é»é¸ä¸‹é¢çš„æŒ‰éˆ•ï¼Œæˆ‘ä¾†å¹«ä½ æ±ºå®šä»Šå¤©åƒä»€éº¼ï½")

root.mainloop()

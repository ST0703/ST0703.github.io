<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>午餐建議機器人</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    .chat {
      max-width: 420px;
      margin: auto;
      background: #ffffff;
      border-radius: 10px;
      padding: 10px;
      height: 450px;
      overflow-y: auto;
    }
    .bubble {
      max-width: 70%;
      padding: 8px 12px;
      margin: 6px 0;
      border-radius: 12px;
      clear: both;
      font-size: 14px;
    }
    .bot {
      background: #eeeeee;
      float: left;
    }
    .user {
      background: #dcf8c6;
      float: right;
    }
    .buttons {
      max-width: 420px;
      margin: 10px auto 0;
      display: flex;
      justify-content: space-between;
    }
    button {
      flex: 1;
      margin: 0 4px;
      padding: 8px 0;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="chat" id="chat"></div>

<div class="buttons">
  <button onclick="choose('便當')">便當</button>
  <button onclick="choose('麵')">麵</button>
  <button onclick="choose('飯')">飯</button>
  <button onclick="choose('速食')">速食</button>
  <button onclick="choose('隨機')">隨機</button>
</div>

<script>
  const LUNCH_OPTIONS = {
    便當: ["雞腿便當", "排骨便當", "滷肉便當", "蔬菜便當"],
    麵: ["牛肉麵", "乾拌麵", "拉麵", "炒麵"],
    飯: ["咖哩飯", "炒飯", "丼飯", "滷肉飯"],
    速食: ["漢堡", "炸雞", "披薩", "薯條"]
  };

  const today = new Date().toISOString().slice(0, 10);
  let record = JSON.parse(localStorage.getItem("lunchRecord"));

  if (!record || record.date !== today) {
    record = { date: today, used: [] };
    localStorage.setItem("lunchRecord", JSON.stringify(record));
  }

  const chat = document.getElementById("chat");

  function addBubble(text, type) {
    const div = document.createElement("div");
    div.className = "bubble " + type;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  function getSuggestion(category) {
    let options = [];

    if (category === "隨機") {
      for (let key in LUNCH_OPTIONS) {
        options = options.concat(LUNCH_OPTIONS[key]);
      }
    } else {
      options = LUNCH_OPTIONS[category];
    }

    const available = options.filter(f => !record.used.includes(f));

    if (available.length === 0) {
      return "今天的餐點都被推薦過了";
    }

    const choice = available[Math.floor(Math.random() * available.length)];
    record.used.push(choice);
    localStorage.setItem("lunchRecord", JSON.stringify(record));
    return "今天午餐建議你吃：" + choice;
  }

  function choose(category) {
    addBubble(category, "user");
    const reply = getSuggestion(category);
    setTimeout(() => addBubble(reply, "bot"), 300);
  }

  addBubble("點選下面按鈕，我幫你決定今天吃什麼", "bot");
</script>

</body>
</html>
